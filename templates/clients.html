{% extends "base.html" %}
{% block content %}
  <div class="top">
    <div>
      <div style="font-weight:900;font-size:20px">Clientes</div>
      <div class="muted">Lista com paginação e busca</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <a class="btn secondary" href="/tasks/">Demandas</a>
      <a class="btn secondary" href="/tasks/settings/">Config. Tarefas</a>
      <a class="btn secondary" href="/export.xlsx">Export Excel</a>
      <a class="btn primary" href="/clients/new/">+ Novo</a>
      <form action="/logout/" method="post" style="margin:0">
        {% csrf_token %}
        <button class="btn secondary" type="submit">Sair</button>
      </form>
    </div>
  </div>

  <div class="card" style="padding:14px">
    <form method="get" class="row" style="align-items:end">
      <div style="flex:1;min-width:220px">
        <div class="muted" style="font-weight:800">Filtro</div>
        <input class="input" name="q" value="{{ q }}" placeholder="Buscar cliente..." />
      </div>
      <button class="btn primary" type="submit">Buscar</button>
    </form>

    <div style="margin-top:14px;display:grid;gap:10px">
      {% for c in page_obj %}
        <a class="card" style="display:block;padding:12px;border-radius:14px" href="/clients/{{ c.id }}/">
          <div style="font-weight:900">{{ c.name }}</div>
          <div class="muted">{{ c.status|default:"—" }}{% if c.cnpj %} • CNPJ: {{ c.cnpj }}{% endif %}</div>
        </a>
      {% empty %}
        <div class="muted">Nenhum cliente.</div>
      {% endfor %}
    </div>

    <div style="margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <div class="muted">Página {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</div>
      <div style="display:flex;gap:8px">
        {% if page_obj.has_previous %}
          <a class="btn secondary" href="?q={{ q }}&page=1">«</a>
          <a class="btn secondary" href="?q={{ q }}&page={{ page_obj.previous_page_number }}">←</a>
        {% else %}
          <span class="btn secondary" style="opacity:.5;pointer-events:none">«</span>
          <span class="btn secondary" style="opacity:.5;pointer-events:none">←</span>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="btn secondary" href="?q={{ q }}&page={{ page_obj.next_page_number }}">→</a>
          <a class="btn secondary" href="?q={{ q }}&page={{ page_obj.paginator.num_pages }}">»</a>
        {% else %}
          <span class="btn secondary" style="opacity:.5;pointer-events:none">→</span>
          <span class="btn secondary" style="opacity:.5;pointer-events:none">»</span>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
